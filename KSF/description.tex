% This file is part of the GetRichOrDieTrying / KSF project
% Copyright 2019 the authors.

% to-do
% -----
% - draft all sections

\documentclass[12pt, fullpage, letterpaper]{article}
\usepackage{fancyheadings}
\usepackage{xspace}
\input{hogg_nsf}

% headers and footers
\setlength{\headsep}{2ex}
\renewcommand{\headrulewidth}{0pt}
\pagestyle{fancy}
\newcommand{\thistitle}{\acronym{CDS\&E}: Betterizing the next generation of cosmology surveys}
\lhead{\textcolor{darkgrey}{\textsf{Hogg \& Storey-Fisher / \thistitle}}}
\rhead{\textcolor{darkgrey}{\textsf{\thepage}}}
\cfoot{}
\newcommand{\KSF}[1]{\textcolor{teal}{KSF: #1}}
\newcommand{\cf}{2pcf\xspace}


\begin{document}

The cold-dark-matter-with-a-cosmological-constant (\LCDM) model is
very well established observationally, having explained many different
kinds of data with a small number of free parameters, and having made
some ab-initio predictions (like the baryon acoustic feature; CITE)
prior to the observations.
It's almost certainly \emph{not the true model}.
It seems unlikely that the dark sector is a single species, with no
non-gravitational interactions, and no interesting thermodymamic or
dynamical features.
However, what is well established is the following:
Whatever \emph{is} the true model \emph{is very well approximated} by
\LCDM\ over a wide range of scales in length and density.
So the \LCDM\ deserves our respect and our attention.
And it also deserves our criticism and our scrutiny.
Here we proceed with both.

In addition to the importance and success of the \LCDM\ model---or
really because of it---the principal cosmological parameters (which
can be thought of as the age, the densities in various components, and
the power spectrum of the initial conditions) are measured in data
with percent-level precision.
And maybe the over-arching theme of astrophysics, historically, is
that with new precision comes new opportunities!
The current and next generations of surveys hope to
make measurements of effects which enter at sub-percent levels:
For example, it's looking likely that we can measure the total mass in
neutrinos just from observations of large-scale structure and the
cosmic microwave background, when this is truly a trace component,
dynamically.
This would answer questions that direct mass measurement experiments
can't answer yet, or ever if there are contributions from sterile
neutrinos.
For another example, if the cosmological constant turns out to be a particle rather
than a term in general relativity, we now know, observationally, that
the differences that makes will appear at sub-percent level in the
expansion history and the growth of structure.

For us, these are just examples of things we might be doing in the
coming decade.
Here we propose to design, build, and exercise tools that will be
valuable no matter what the questions of cosmology become.
In our view, given the success and precision of the current
cosmological model, new projects either have to obtain
\textbf{substantially more precision}, or else look for subtle
\textbf{departures from predictions}.
That is, we want to see small effects, and in particular, small
effects that might call into question the deep assumptions of the
\LCDM\ model.

Doing better than has ever been done before will require work along
multiple axes.
The first axis is \emph{volume}: We need to observe more volume. This
is happening now, with projects like HOGG, KSF: PROJECT LIST WITH
CITATIONS.
But of course this new volume comes at a cost: As we look to larger
distances and larger volumes with denser tracers, we push our
observations to noisier targets with less-well-measured individual
properties.
That is, as the data get better in a global sense (more volume, more
modes measured), it gets worse in an individual-object sense (fewer
bits per target, more contamination from foregrounds and backgrounds).

This all leads to the second axis along which we have to work, which
is calibration, contamination, and window functions:
As the data get harder to use at the individual-object level, it is
harder to know that we have surveyed the volume uniformly, or, more
importantly, do we understand the non-uniformity of our sampling?
Survey window function knowledge starts to depend on things about the
observational projects that we can't know well, like small-scale
variations of the point-spread function or temporal variability of the
photometric bandpasses.
In this context we are pushed to data-driven techniques for
understanding the selection, which connect to ideas of
self-calibration, where the PI has been a pioneer.

And the third axis is statistical sophistication.
As we simultaneously move to higher precision requirements, and larger
volumes of data, and with lower-precision individual-object data, it is 
easier and easier to get fooled.
This fooling can come in the form of systematic effects (like
photometric calibration or foregrounds) in the data projecting onto
tiny physical effects (like neutrino masses) in the clustering.
Or it can come in the form of anomalies appearing: If the volume is
huge, the effective size of any search is huge.
We \emph{will} discover anomalies; the hard question will be whether
they are statistically significant or worth further study.
This gets into issues of multiple hypothesis testing, which we will
discuss below.
But these two issues directly combine, because unmodeled or
incorrectly modeled systematic issues in the data will project onto
discoverable anomalies.
So if we are going to search the next generation of surveys for
interesting new departures from baseline theoretical expectations,
we better have a very solid statistical plan.

This proposal is to build and exercise general-purpose tools that will
make the next generation of (galaxy, quasar, and intensity-mapping)
large-scale structure (\LSS) surveys more precise, more powerful, and
more capable of making truly new discoveries.
The project has three themes, which connect to the three axes above in
various ways.
In the first theme, we replace the standard estimator for clustering or
correlation functions with something far more flexible, which permits us
to do more with more cosmological volume at fixed computation.
In the second, we analyze, attack, and re-build the self-calibration 
methods for window function estimation.
In the third, we perform a very false-positive-safe search for anomalies
in the large-scale structure, to identify departures that might point to
new physics.

\section{First theme: A new estimator for galaxy clustering}

The project will build and operate a new estimator for
galaxy clustering that obviates binning of objects (galaxies or
quasars or pixels) or pairs into bins; instead it estimates continuous
functional forms for clustering as a function of scale, galaxy mass,
color, and so on.
These continuous functional forms make a better representation of the
clustering than any binning; therefore this estimator can do more with
fewer clustering-model components.
This in turn lets it make more powerful measurements with less data,
and with less of the computation that is used to do uncertainty
propagation.


\subsection{Background and Motivation: The Two-Point Correlation Function}

\KSF{We should discuss how to use subsections}

\KSF{Haven't added in my bibtex yet will do!}

Galaxy clustering is one of the most important tracers of the large-scale structure of the universe.
The distribution of galaxies contains information about the universe's evolution and fundamental components, as well as the evolution of the galaxies themselves.
To study the clustering of galaxies, we use observational galaxy surveys that range from hundreds to millions, and soon billions, of galaxies, and are pushing to even higher redshifts.
\textbf{Due to the increased size and complexity of next-generation galaxy surveys, the tools currently used to characterize galaxy clustering will not be sufficient}.
We propose to address this problem by developing new methods for the analysis of galaxy clustering from observational surveys.

The distribution of galaxies in a volume of sky can be modeled as a spatial point process.
We can use the statistics of point processes to characterize their clustering, giving us insight into the physical processes that produce this distribution.
One of the most common statistics used to analyze galaxy surveys is the two-point correlation function (\cf). 
\textbf{The \cf is critical for inferring certain cosmological parameters, determining the distance scale in the early universe, and constraining galaxy formation by examining how clustering depends on galaxy properties.}
 
The canonical estimator for the galaxy \cf, originally proposed by \citep{LandySzalay1993}, estimates the excess number of galaxies in bins of spatial separation $r$, compared to a statistically random distribution.
However, this estimator suffers from several limitations. 
It is computed in bins of radial separation between pairs, and choosing the number of bins is a trade-off between bias and variance.
Furthermore, for any finite binning in separation, this estimator contains a statistical bias when applied to highly clustered data (e.g. \citealt{Kerscher1998}).
Another binned dimension is often used to characterize the dependence on galaxy properties: the galaxies are divided into subsamples to analyze the relationship between their properties and clustering. 
\KSF{I'm not convinced about this application yet so may want to cut, or only mention briefly as a possibility}
One tool developed to address this is the marked correlation function, in which galaxies are weighted by the desired property.
Li \& White (2010) showed that luminosity-weighting can place tighter constraints on galaxy formation, but this approach still requires $r$-binning and doesn't account for the survey window.
While these estimators have been sufficient for past analyses, an improved estimator is necessary for future surveys.

\subsection{The Continuous-Function Estimator}

In order to avoid the issues introduced by finite binning with current estimators, we have developed an approach based on continuous basis functions. 
Inspired by linear least-squares fitting, it replaces scalar pair counts with a vector of the values output by the basis function, and the normalization term by a tensor of these values.
For the case of tophat (rectangular) basis functions, this reduces to the standard Landy-Szalay estimator.
A set of basis functions can be chosen specific to the scales, features and properties of interest.
For example, higher order spline basis functions could be chosen to achieve a smooth statistic. 
A set of functions that select expected features in the correlation function, such as the baryon acoustic feature, would allow for a more direct measurement of that feature.
Additionally, basis functions can depend on other properties of the tracer, such as galaxy luminosity or redshift.
Thus our estimator not only removes the need for binning in spatial separation, but can also be used where subsample approaches are currently needed.

We have implemented an initial version of the continuous-function correlation function estimator.
The estimator is built in C within the \texttt{corrfunc} package \citep{Sinha2017}, which performs fast pair-counting on a lattice.
To test the estimator, we have generated lognormal catalogs with a known correlation functions. 
\textbf{We expect these to show that, compared to the Landy-Szalay estimator, my estimator produces a smoother \cf with lower bias and lower variance with respect to the true correlation function.} \KSF{What tense should we be working in? Mix of "have found this already" and "expect to find this"?}

Due to this smoothness, this estimator should be able to not only produce a more accurate correlation function, but do so with fewer basis functions.
This means that fewer mock catalogs will be needed to produce a covariance matrix, reducing the computational cost of computing the \cf.
The expensive simulations required to build a set of mock catalogs for each dataset is one of the limiting factors in correlation function analyses.
Our estimator will significantly reduce this requirement and allow for faster and more accurate analyses.

Alongside this work, we have revisited the statistical literature and identified how the bias due to binning and edge correction is entering. 
We will use this understanding to develop an estimator that doesn't suffer from this bias.
We will combine these two approaches to develop and implement an estimator for galaxy clustering that is fundamentally unbiased and can be tailored for specific science use cases.
\KSF{This is referring to "Barnett things" - do we want to mention?}

\subsection{Applications: The BAO Peak and Galaxy Evolution}

The clustering of galaxies is a critical probe of the baryon acoustic feature. 
This is a signature of Baryon Acoustic Oscillations (BAO) in the early universe, acoustic waves of photon-baryon fluid that traveled through the universe. 
When the universe cooled enough to cause their decoupling, extra matter was deposited at the scale corresponding to the distance travelled. 
Today this overdensity should be at a scale of around 120 Mpc/h, and indeed we see a peak there in the correlation function. 
The exact BAO scale can be extracted from the binned \cf by comparing it to theoretical models of the correlation function. 
With our estimator, we can directly project the galaxy pairs onto these models. 
Specifically, we will use as one of my basis functions a canonical model of the correlation function with the Planck best-fit cosmological parameters. 
The other basis functions are derivatives of this model with respect to the parameters we are interested in, in this case the matter density, baryon density and spectral index. \KSF{There are multiple ways to do this and I'm not yet sure which is best / we will do so maybe we shouldn't get this specific}
\textbf{This eliminates potential error due to the arbitrary choice of bins, and allows for a direct estimation of the cosmological parameters and the BAO scale.} \KSF{These might be more separate measurements than I'm describing}
We will compare this method to the traditional technique, and expect to show that this method produces more precise measurements of the sound horizon with fewer components.

Galaxy evolution is one of the biggest open research topics in modern astrophysics.
The two-point correlation function allows us to ask questions about how the formation of galaxies is related to the evolution of structure in the universe.
The dependence of galaxy clustering on the properties of galaxies, such as their line luminosity and star formation rate, gives insight into this relation.
Our proposed estimator will allow us to extract even more information about this dependence. 
We plan to construct basis functions that contain a dependence on the galaxy property, allowing for a combined encoding of both separation and luminosity. 
We can then quickly evaluate the estimator at any set of luminosities and produce a smooth correlation function for each. 
We will compare this method to the common subsampling approach; \textbf{we expect to show that this method will allow us to interpret the luminosity dependence in more detail and with higher precision.}

In order to characterize the clustering from these surveys, we must remove systematic effects.
Systematics are any issues with the data that produce variations in the density or redshift distribution of the sample, therefore imprinting non-cosmological signals on large-scale structure analyses.
For instance, the galaxy number density varies with the width of the point spread function (PSF), as observations with a wider PSF may obscure galaxies.
Even small systematic effects, such as those from airmass and stellar contamination, can bias large surveys like WFIRST. 
Objects in high-redshift surveys may be particularly sensitive to issues like color selection and instrument calibration.
Current methods assume simple systematics models that don't capture nonlinearities in these effects.
While linear corrections are adequate for most of today's surveys, next-generation surveys will have a combination of more complicated window functions, noisier foregrounds, and complex observational and instrumental effects.
Failure to fully correct for systematics in future analyses will propagate through clustering analyses and give biased results.

The methods used to characterize the clustering can also introduces biases.
The two-point correlation function (\cf), the most important statistic used to measure spatial clustering, cannot be computed exactly due to edge effects from the survey window.
We use estimators of the \cf to account for this, but these introduce their own issues, including a bias due to finite spatial binning.

We propose new methods to address galaxy clustering challenges for WFIRST and LAGER.
These will also be important for other current and future missions.
The eBOSS survey within the Sloan Digital Sky Survey (SDSS) is now observing the largest volume to date \citep{Dawson2015}. 
DESI \citep{Aghamousa2016} will begin taking data in 2019, followed by NASA's Euclid mission \citep{Amiaux2012} and LSST \citep{Ivezic2018} in 2021.
\textbf{Our methods will improve the level of precision and accuracy on all of these surveys, permitting better constraints on large-scale structure and creating discovery potential.}

Call out \textbf{Intellectual merit}.
This project will deliver both general methods and specific, released,
open-source code that works efficiently on current data and can be
incorporated into current and future analysis pipelines. And: less computing!

Call out \textbf{Broader impacts}.



\section{Second theme: Adversarial approaches to systematics}

The project will build adversarial simulated data that is
designed to defeat current methodologies for finding and correcting
systematic effects of calibration and target selection in \LSS\ 
surveys. And then build far more general calibration
programs, based on non-parametric models, that can defeat the
adversaries.

To remove biases that enter through systematic effects, we are developing an approach inspired by adversarial machine learning methods. 
We will generate survey-specific catalogs with ``adversarial'' data that contains density variations due to nonlinear combinations of systematics.
We will then use probabilistic machine learning techniques to interpolate these nonlinear functions.

\subsection{Background: Systematics correction in galaxy surveys}

To make accurate cosmological measurements and detect potential deviations from the predicted model, we require not only robust statistics, but clean, unbiased datasets on which to apply them.
Observed galaxy catalogs are necessarily imperfect due to systematic effects in observation and instrumentation. 
In order to characterize the clustering from these surveys, we must remove these effects.

Systematics are any issues with the data that produce variations in the density or redshift distribution of the sample, therefore imprinting non-cosmological signals on large-scale structure analyses.
For instance, the galaxy number density varies with the width of the point spread function (PSF), as observations with a wider PSF may obscure galaxies.
Even small systematic effects, such as those from airmass and stellar contamination, can bias large surveys. 
Objects in high-redshift surveys may be particularly sensitive to issues like color selection and instrument calibration.
Current methods assume simple systematics models that don't capture nonlinearities in these effects.
While linear corrections are adequate for most of today's surveys, next-generation surveys will have a combination of more complicated window functions, noisier foregrounds, and complex observational and instrumental effects.
Failure to fully correct for systematics in future analyses will propagate through clustering analyses and give biased results.

One common approach to correcting survey systematics is with regression-based techniques (see e.g. \citealt{Ross2010}). \KSF{At least mention other methods (mode projection and monte carlo)}
Weights for important systematic parameters are determined by performing a fit, typically linear or quadratic, to adjust for dependencies between galaxy density and each parameter.
These are combined into a single weight for each galaxy, which are then used in computing the \cf.
\textbf{The standard technique is unable to account for higher order corrections or interdependence between systematic parameters; these complexities may propagate through analyses and bias galaxy clustering results.}

\subsection{Motivating new correction methods: adversarial mock catalogs}

In order to address complex systematics, we will build a comprehensive testing suite of mock galaxy catalogs, injected with artificial systematic effects.
With these, we will demonstrate the regimes in which current systematics correction methods become insufficient.
These are ``adversarial'' in that there is a tension between hiding systematics in the dataset and detecting these effects, and we can exploit this to improve our detection.
The systematics will be designed to be difficult to detect, and our detection method will be challenged to correct for these systematics. 
We expect to show that our approach to systematics correction addresses some of the insufficiencies of current methods, resulting in less biased measurements and the ability to detect subtle signals in the distribution.

Our testing suite will include toy models as well as catalogs modeled after target surveys, with the appropriate window function.
We will inject systematic biases in density by subsampling the galaxies based on adversarially complex functions of the metadata.
The result will be comprehensive testing suites that cover many systematic effects and range from simple combinations to extreme variation.
\textbf{These adversarial extremes will create discovery potential by showing that systematics may be obscuring physical information.}
We plan to explore observables that are motivated by current theoretical models.
For example, deviations at the largest scales could indicate primordial non-Gaussianities \citep{Dalal2008}. \KSF{Connect to anomalies section here!}


\subsection{Defeating adversarial systematics: probabilistic machine learning methods}

Ideally, systematics and clustering should be modeled simultaneously. 
However, even forward modelling these individually is currently untenable. \KSF{Suchyta 2016 was cited by Rezaie 2019 wrt forward modelling systematics, dig into lit here} 
While likelihood-free inference could provide an eventual path forward, for the near-future we can develop more sophisticated methods to calibrate out systematics before performing clustering analyses.
Machine learning methods have already shown promise in systematics removal in other subfields.
Adversarial neural networks have been used to remove the jet background in particle collision data at the Large Hadron Collider \citep{Shimmin2017}.
Gaussian processes (GPs) have been used to correct for instrumental systematics in exoplanet transit surveys \citep{Gibson2012, Aigrain2016}. 
GPs lend themselves to this type of problem, as they allow for nonlinear interpolation over the data space; we propose to use GPs to remove systematics in galaxy surveys.

GPs are a Bayesian approach to modeling data; they define a prior distribution over a function space, and then use the known data to produce a posterior probability distribution over unknown values. 
In practice, GPs learn the labels of a training set and generate hyperparameters characterizing the data.
These can then be used to label previously unseen data by performing a nonlinear regression over the training data space.
In our application, we will model the galaxy density and redshift distribution as complex functions of observational metadata, as described above.
\textbf{We will train the GP on the adversarial mock catalog, and then use it predict the functions that generated the systematic effects by performing a regression over the training data space.}
We can then correct for these systematics in new surveys by assigning the galaxies weights determined by these functions.

We expect to show that our GP approach does better at recovering unbiased clustering statistics for a typical level of systematics, compared to traditional methods.
Further, we will perform this test on catalogs with extreme systematics that could be obscuring interesting clustering features; we expect traditional methods to be unable to detect these features, while our method should reveal this information.
Our systematics calibration method will improve current measurements by reducing systematic biases and open up more discovery space in galaxy clustering analyses.

Call out \textbf{Intellectual merit}.
This project will make NSF-funded cosmology projects (including
\SDSSIV, \DESI, and \LSST) more productive, more precise, and more
capable of making ground-breaking discoveries.



\section{Third theme: Searches for anomalies}

Contemporary observational large-scale structure science---and
cosmology in general---is very focused on parameter estimation.
And rightly so!
The cosmological parameters are known now to incredible precision.
And new effects are coming visible in the near future, which will add
new parameters to the list and permit us to estimate current
parameters even more precisely.

In addition, parameter estimation is a very well-defined activity:
Parameter estimation proceeds by performing likelihood-based or
Bayesian inferences.
The best-fit (or measured or estimated) parameter values are those at
(or near) the peak in the log-likelihood function, or the (log)
probability of the data given the parameters and the fundamental
physical assumptions.
The best possible precision with which the parameters can be measured
is related to the Fisher information, which is (in turn) the second
derivative of that log-likelihood function.
The activity of parameter estimation has the beauty that it is a fully
worked out and justified procedure in classical statistics, and it
delivers results that can be judged in the framework of information
theory.
And we are really, really good at it.

Interestingly and importantly to our story,
parameter estimation can proceed \emph{whether or not the fundamental theory
is in fact a good fit to the data}.
That is, it doesn't depend on the model being \emph{good}.
It depends only on the data being precise, and the parameters showing
effects in our expections for the data (as encoded by the log-likelihood function).

But we believe that it makes sense to think about the goodness-of-fit,
or the respects in which the data do and do not fit the model.
This question is as old (in statistics) as the question of parameter
estimation, and older, even in the history of cosmology.
But it is a harder question, because it involves comparing
qualitatively different models or paradigms.

We are going to phrase these questions of goodness-of-fit in terms of
\emph{anomalies}, or respects in which the data \emph{do not conform}
to the predictions of the dominant paradigm.
We are suggesting this focus on anomalies for two connected reasons.
The first is....productivity of CMB anomalies

The second reason for the focus is....the \LCDM\ model is surely an
approximation!

HOGG: MAKE SURE ALL THIS GETS SAID IN THIS SECTION, OR MODIFY THE SUMMARY:
The project will build methodologies that perform (and perform
ourselves) statistically principled brute-force searches of \LSS\ 
surveys (current and future) for theory-motivated departures from
predictions of the \LCDM\ model.
The cosmological model is very successful.
But the discovery of a departure at intermediate-to-large scales
(where the physical model is extremely accurate) would be so important
and significant that it is worth investing effort here.
The principled aspects of the project will include pre-registration of
hypotheses (that is, an enumeration of the specific forms and kinds of
deviations) prior to search.
And this tool category is related to the previous two, because we need
to distinguish small departures from systematic effects, and we need
to extract signatures at bound-saturating precision.

HOGG: Call out \textbf{Intellectual merit}.
This project will establish methods for pre-registration of hypotheses that
will be of general value in cosmology and other areas in the natural
sciences.

HOGG: Call out \textbf{Broader impacts}.

\section{Workshops and pedagogical publications}

In executing the project, the investigators will build curricular
materials for undergraduate-to-PhD bridge programs, preparing students
in the physical sciences to have better data-science and statistics
skills and therefore better PhD preparations.
We will test and refine these curricular materials in workshops for
students of broad backgrounds in New York City.

Call out \textbf{Intellectual merit}.

Call out \textbf{Broader impacts}.

\section{Prior NSF support}

Here we list recent \NSF\ grants that have supported the PI and say a
few words about each of them.
In addition to these projects supporting PI Hogg, it is also the case
that Storey-Fisher WAS SUPPORTED PARTIALLY BY WHAT PREVIOUSLY?

\paragraph{\acronym{OAC-1841594}: Collaborative Research: Community Planning for Scalable Cyberinfrastructure to Support Multi-Messenger Astrophysics (2018-2020):}
This one-year (plus extension) grant (for \$36K) is part of...

\paragraph{\acronym{AST-1517237}: New Probabilistic Methods for Observational Cosmology (2015--2019):}
This grant (for \$328K) supported...

\paragraph{\acronym{IIS-1124794}: A Unified Probabilistic Model of Astronomical Imaging (2011--2016):}
This grant (for \$675K) was a Cyber-Enabled Discovery Type I Grant which supported...

\paragraph{\acronym{AST-0908357}: Dynamical models from kinematic data:\ The Milky Way Disk and Halo (2009-2011):}
This grant (for \$147K) supported...

\section{Relevance to NSF priorities and programs}

In addition to being relevant to \NSF\ \acronym{AAG} Program, this project also
connects strongly to the \NSF\ \acronym{CDS\&E} program.
HOGG: What more should be said here?

This project touches on the following three \NSF\ themes:

\paragraph{Harnessing the Data Revolution:}

\paragraph{Growing Convergence Research:}

\paragraph{Windows on the Universe:}

\section{Not-so-frequently asked questions}

We recognize that reviewing NSF proposals can be challenging.
For this reason, we have tried to anticipate and answer some of the
questions that you, as a reviewer, may have, after reading this
proposal.

\textit{How is this a \acronym{CDS\&E} proposal?}

\textit{Isn't it ridiculous to look for anomalies in the large-scale structure?}

\textit{Your clustering estimator seems so general, why are you spending so many words talking about how it relates to simulations?}

\textit{KSF: etc..?}

\end{document}
